<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Clinic Admin - Logs Dashboard</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }
    h2 { text-align: center; color: #00ff99; }
    .pin-screen, .logs-screen { max-width: 800px; margin: auto; display: none; }
    input[type="password"], input[type="text"], select {
      width: 100%; padding: 10px; font-size: 16px; margin-top: 15px; border-radius: 5px; border: none;
    }
    button {
      padding: 10px 20px; font-size: 16px; margin-top: 20px;
      background: #00ff99; border: none; cursor: pointer; border-radius: 5px;
    }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td {
      padding: 8px;
      border-bottom: 1px solid #444;
      text-align: left;
    }
    .filter-controls { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
    @media (min-width: 600px) {
      .filter-controls { flex-direction: row; justify-content: space-between; }
    }
  </style>
</head>
<body>

  <!-- PIN Entry Screen -->
  <div class="pin-screen" id="pinScreen">
    <h2>üîê Admin Access</h2>
    <input type="password" id="pinInput" placeholder="Enter PIN (e.g. 2525)">
    <button onclick="checkPIN()">Unlock Logs</button>
  </div>

  <!-- Logs Dashboard -->
  <div class="logs-screen" id="logsScreen">
    <h2>üìã Patient Booking Logs</h2>

    <div class="filter-controls">
      <input type="text" id="searchInput" placeholder="Search by name or reason..." onkeyup="filterLogs()" />
      <select id="dateFilter" onchange="filterLogsByDate()">
        <option value="">All Dates</option>
      </select>
      <button onclick="exportLogs()">üì§ Export</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Date</th><th>Time</th><th>Name</th><th>Reason</th>
        </tr>
      </thead>
      <tbody id="logBody"></tbody>
    </table>
  </div>

  <!-- Dark/Light Theme Toggle -->
  <div style="position:fixed;top:10px;right:10px;z-index:999;">
    <button onclick="toggleTheme()" style="padding:8px 16px;background:#ccc;color:#000;border:none;border-radius:5px;">üåì Theme</button>
  </div>

  <script>
    const PIN = "2525"; // Admin PIN
    const csvUrl = "https://warangalonepoint.github.io/clinic-admin/logs.csv"; // Live CSV
    const pinScreen = document.getElementById("pinScreen");
    const logsScreen = document.getElementById("logsScreen");

    pinScreen.style.display = "block";

    function checkPIN() {
      const entered = document.getElementById("pinInput").value;
      if (entered === PIN) {
        pinScreen.style.display = "none";
        logsScreen.style.display = "block";
        loadLogs();
      } else {
        alert("‚ùå Incorrect PIN");
      }
    }

    function loadLogs() {
      fetch(csvUrl)
        .then(res => res.text())
        .then(data => {
          const rows = data.trim().split("\n").slice(1).map(line => line.split(","));
          const logBody = document.getElementById("logBody");
          const dateDropdown = document.getElementById("dateFilter");
          const uniqueDates = new Set();

          logBody.innerHTML = "";

          rows.forEach(([date, time, name, reason]) => {
            const row = `<tr><td>${date}</td><td>${time}</td><td>${name}</td><td>${reason}</td></tr>`;
            logBody.innerHTML += row;
            uniqueDates.add(date);
          });

          // Populate date filter
          uniqueDates.forEach(date => {
            const opt = document.createElement("option");
            opt.value = date;
            opt.textContent = date;
            dateDropdown.appendChild(opt);
          });
        });
    }

    function filterLogs() {
      const term = document.getElementById("searchInput").value.toLowerCase();
      const rows = document.querySelectorAll("#logBody tr");
      rows.forEach(row => {
        row.style.display = row.innerText.toLowerCase().includes(term) ? "" : "none";
      });
    }

    function filterLogsByDate() {
      const date = document.getElementById("dateFilter").value;
      const rows = document.querySelectorAll("#logBody tr");
      rows.forEach(row => {
        const rowDate = row.children[0].innerText;
        row.style.display = (date === "" || rowDate === date) ? "" : "none";
      });
    }

    function exportLogs() {
      fetch(csvUrl)
        .then(res => res.blob())
        .then(blob => {
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = "logs.csv";
          a.click();
        });
    }

    function toggleTheme() {
      const dark = document.body.style.backgroundColor === "black" || document.body.style.backgroundColor === "#111";
      if (dark) {
        document.body.style.backgroundColor = "#fff";
        document.body.style.color = "#000";
        document.querySelectorAll("th, td, input, select").forEach(el => el.style.color = "#000");
      } else {
        document.body.style.backgroundColor = "#111";
        document.body.style.color = "#fff";
        document.querySelectorAll("th, td, input, select").forEach(el => el.style.color = "#fff");
      }
    }
  </script>
</body>
</html>
