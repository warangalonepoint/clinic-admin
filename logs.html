<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Logs Dashboard</title>
  <style>
    body {
      background-color: #000;
      color: #0fffb7;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    h1, h2 {
      text-align: center;
    }

    .log-summary {
      margin-bottom: 30px;
    }

    .summary-item {
      margin: 10px 0;
      font-size: 18px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #111;
      color: #fff;
    }

    th, td {
      border: 1px solid #0fffb7;
      padding: 10px;
      text-align: left;
    }

    th {
      background-color: #222;
    }

    #searchInput {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      margin-bottom: 20px;
      background: #000;
      color: #0fffb7;
      border: 1px solid #0fffb7;
    }

    textarea {
      width: 100%;
      height: 60px;
      background: #000;
      color: #0fffb7;
      margin-top: 5px;
      border: 1px solid #0fffb7;
      border-radius: 6px;
      padding: 5px;
    }

    button {
      margin-top: 5px;
      background: #0fffb7;
      color: #000;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .patient-card {
      background: #111;
      color: #fff;
      padding: 15px;
      border: 1px solid #0fffb7;
      margin-bottom: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <h1>üìä Booking Logs</h1>

  <div class="log-summary" id="summaryPanel">
    <div class="summary-item">Total Bookings: <span id="totalBookings">0</span></div>
    <div class="summary-item">Today‚Äôs Bookings: <span id="todaysBookings">0</span></div>
  </div>

  <table id="logTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Time</th>
        <th>Name</th>
        <th>Phone</th>
        <th>Reason</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div style="margin-top: 40px;">
    <h2>üìù Patient History Lookup</h2>
    <input type="text" id="searchInput" placeholder="Search by patient name or time">
    <div id="patientResults" style="margin-top: 20px;"></div>
  </div>

  <script>
    const logsURL = "https://warangalonepoint.github.io/clinic-admin/logs.csv";
    let patientLogs = [];

    fetch(logsURL)
      .then(res => res.text())
      .then(csv => {
        const lines = csv.trim().split("\n");
        const headers = lines[0].split(",");
        const now = new Date().toISOString().split("T")[0];
        let todayCount = 0;

        lines.slice(1).forEach((line, index) => {
          const data = line.split(",");
          const entry = {};
          headers.forEach((key, i) => {
            entry[key.trim()] = data[i]?.trim() || "";
          });
          patientLogs.push(entry);

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${entry.Date || ''}</td>
            <td>${entry.Time || ''}</td>
            <td>${entry.Name || ''}</td>
            <td>${entry.Phone || ''}</td>
            <td>${entry.Reason || ''}</td>
          `;
          document.querySelector("#logTable tbody").appendChild(tr);

          if (entry.Date === now) todayCount++;
        });

        document.getElementById("totalBookings").textContent = patientLogs.length;
        document.getElementById("todaysBookings").textContent = todayCount;
      });

    document.getElementById("searchInput").addEventListener("input", function () {
      const query = this.value.toLowerCase();
      const results = patientLogs.filter(log =>
        log.Name?.toLowerCase().includes(query) || log.Time?.toLowerCase().includes(query)
      );

      const container = document.getElementById("patientResults");
      container.innerHTML = "";

      results.forEach((log, index) => {
        const noteId = `note_${index}`;
        container.innerHTML += `
          <div class="patient-card">
            <strong>${log.Date || ''} | ${log.Time || ''}</strong><br>
            üë§ <b>${log.Name || 'Unknown'}</b><br>
            üìû Phone: ${log.Phone || 'N/A'}<br>
            üìã Reason: ${log.Reason || 'N/A'}<br>
            <label>Doctor Note:</label>
            <textarea id="${noteId}">${log.Note || ''}</textarea>
            <button onclick="alert('Note saved locally. Export feature coming soon.')">üíæ Save Note</button>
          </div>
        `;
      });
    });
  </script>

</body>
</html>
