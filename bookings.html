<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Book Appointment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }

    h1 {
      color: #00ffd5;
      text-align: center;
      margin-bottom: 10px;
    }

    h3 {
      color: #ff1493;
      text-align: center;
    }

    #slotsContainer {
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .slot-card {
      background-color: #222;
      border: 1px solid #00ffd5;
      padding: 15px;
      margin: 10px;
      width: 90%;
      max-width: 400px;
      border-radius: 10px;
      text-align: center;
    }

    .slot-card button {
      background-color: #00ffd5;
      color: #000;
      border: none;
      padding: 10px 15px;
      margin-top: 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    .slot-card button:hover {
      background-color: #00ccaa;
    }

    .form-section {
      margin: 20px auto;
      max-width: 400px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    input, textarea {
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
      width: 100%;
    }

    #noSlots {
      text-align: center;
      color: #f36;
      margin-top: 30px;
    }
  </style>
</head>
<body>
  <h1>Book Your Appointment</h1>
  <h3>Select a time slot below and confirm via WhatsApp</h3>

  <div class="form-section">
    <input type="text" id="name" placeholder="Your Name" required />
    <textarea id="reason" placeholder="Reason for Visit" rows="2" required></textarea>
  </div>

  <div id="slotsContainer"></div>
  <div id="noSlots" style="display:none;">No available slots right now. Please check back later.</div>

  <script>
    const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQQyTuJ2qw0Yxk6GKRdpbzWtoYcKJy2nfVcq294q0aSpyCsntFJ01fKjjgBAesic7g8cCbEK_lUWVdr/pub?gid=642851090&single=true&output=csv";

    function getTodayDateIST() {
      const now = new Date();
      const offset = 5.5 * 60; // IST
      const local = new Date(now.getTime() + offset * 60000);
      return local.toISOString().split("T")[0];
    }

    function createWhatsAppLink(name, reason, date, time) {
      const msg = `Hi, I would like to book an appointment:\n\nName: ${name}\nDate: ${date}\nTime: ${time}\nReason: ${reason}`;
      return `https://wa.me/919390664577?text=${encodeURIComponent(msg)}`;
    }

    function renderSlots(data) {
      const today = getTodayDateIST();
      const slotsDiv = document.getElementById("slotsContainer");
      const noSlotsDiv = document.getElementById("noSlots");
      slotsDiv.innerHTML = "";
      let count = 0;

      data.forEach(row => {
        const [date, time, status] = row;
        if (date === today && status.toLowerCase() === "available") {
          const card = document.createElement("div");
          card.className = "slot-card";
          card.innerHTML = `
            <div><strong>${time}</strong></div>
            <button onclick="bookSlot('${date}','${time}')">Book</button>
          `;
          slotsDiv.appendChild(card);
          count++;
        }
      });

      noSlotsDiv.style.display = count === 0 ? "block" : "none";
    }

    function bookSlot(date, time) {
      const name = document.getElementById("name").value.trim();
      const reason = document.getElementById("reason").value.trim();
      if (!name || !reason) {
        alert("Please enter your name and reason before booking.");
        return;
      }
      const link = createWhatsAppLink(name, reason, date, time);
      window.open(link, "_blank");
    }

    function loadCSV(url) {
      fetch(url)
        .then(res => res.text())
        .then(text => {
          const rows = text.trim().split("\n").slice(1).map(row => row.split(",").map(col => col.trim()));
          renderSlots(rows);
        })
        .catch(err => {
          document.getElementById("noSlots").innerText = "Failed to load slots.";
          document.getElementById("noSlots").style.display = "block";
          console.error("Error loading CSV:", err);
        });
    }

    loadCSV(sheetURL);
  </script>
</body>
</html>
