<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Appointment</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #f77f00;
      margin-bottom: 30px;
    }

    input, select, button {
      width: 90%;
      max-width: 400px;
      margin: 10px auto;
      display: block;
      padding: 15px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
    }

    select, input {
      background-color: #eee;
      color: #000;
    }

    button {
      background-color: #f77f00;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #e76f00;
    }
  </style>
</head>
<body>

  <h2>üìÖ Book Your Appointment</h2>

  <input type="text" id="patientName" placeholder="Enter Your Name" />
  <input type="text" id="reason" placeholder="Reason for Visit" />

  <label>Select Date</label>
  <input type="date" id="appointmentDate" onchange="loadAvailableSlots()" />

  <label>Select Time Slot</label>
  <select id="appointmentTime">
    <option value="">Select Time Slot</option>
  </select>

  <button onclick="showConfirmation()">Confirm Booking</button>

  <script>
    document.getElementById("appointmentDate").addEventListener("change", loadAvailableSlots);
    window.onload = function () {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("appointmentDate").value = today;
      loadAvailableSlots();
    };

    async function loadAvailableSlots() {
      const selectedRawDate = document.getElementById("appointmentDate").value;
      const selectedDate = formatDate(selectedRawDate); // DD-MM-YYYY format
      const timeDropdown = document.getElementById("appointmentTime");
      timeDropdown.innerHTML = "<option value=''>Select Time Slot</option>";

      const slotsResp = await fetch("https://warangalonepoint.github.io/clinic-admin/Slots.csv");
      const slotsText = await slotsResp.text();
      const slotLines = slotsText.split("\n").slice(1).filter(line => line.trim() !== "");

      const availableSlots = [];

      for (const line of slotLines) {
        const [date, time, status] = line.split(",").map(x => x.trim());
        if (date === selectedDate && status === "Available") {
          availableSlots.push(time);
        }
      }

      if (availableSlots.length === 0) {
        const opt = document.createElement("option");
        opt.text = "No slots available";
        opt.disabled = true;
        timeDropdown.appendChild(opt);
      } else {
        availableSlots.forEach(time => {
          const opt = document.createElement("option");
          opt.value = time;
          opt.text = time;
          timeDropdown.appendChild(opt);
        });
      }
    }

    function formatDate(inputDate) {
      if (!inputDate) return "";
      const [yyyy, mm, dd] = inputDate.split("-");
      return `${dd}-${mm}-${yyyy}`;
    }

    function showConfirmation() {
      const name = document.getElementById("patientName").value;
      const reason = document.getElementById("reason").value;
      const date = document.getElementById("appointmentDate").value;
      const time = document.getElementById("appointmentTime").value;

      if (!name || !reason || !date || !time) {
        alert("Please fill in all details before confirming.");
        return;
      }

      const formattedDate = formatDate(date);
      const message = `Hello, I would like to book an appointment:\n\nüë§ Name: ${name}\nüóìÔ∏è Date: ${formattedDate}\n‚è∞ Time: ${time}\nüìå Reason: ${reason}`;

      const encodedMessage = encodeURIComponent(message);
      window.location.href = `https://wa.me/919390664577?text=${encodedMessage}`;
    }
  </script>

</body>
</html>
