<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clinic View</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      padding: 10px;
    }
    .card {
      background-color: #1f1f1f;
      border: none;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .card-title {
      color: #00ff99;
    }
    .table {
      color: #fff;
    }
    .table th {
      color: #00ff99;
    }
    img.logo {
      height: 60px;
      width: 60px;
      object-fit: cover;
      border-radius: 8px;
    }
    @media(max-width: 600px) {
      .table-responsive { font-size: 14px; }
    }
  </style>
</head>
<body><div class="container">
  <div id="clinic-card" class="card d-flex align-items-start">
    <img id="clinic-logo" class="logo me-3" src="" alt="Clinic Logo">
    <div>
      <h4 class="card-title" id="clinic-name"></h4>
      <p id="clinic-address" class="mb-1"></p>
      <p id="clinic-plan"></p>
    </div>
  </div>  <h5 class="mt-4">Today's Appointments</h5>
  <div class="table-responsive">
    <table class="table table-dark table-striped">
      <thead>
        <tr>
          <th>Time</th>
          <th>Patient</th>
          <th>Reason</th>
        </tr>
      </thead>
      <tbody id="appointment-body">
        <tr><td colspan="3">Loading...</td></tr>
      </tbody>
    </table>
  </div>  <h5 class="mt-4">Doctor's Notes</h5>
  <div class="table-responsive">
    <table class="table table-dark table-bordered">
      <thead>
        <tr>
          <th>Time</th>
          <th>Patient</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody id="notes-body">
        <tr><td colspan="3">Loading...</td></tr>
      </tbody>
    </table>
  </div>
</div><script>
  const clinicId = new URLSearchParams(window.location.search).get('clinic')?.toLowerCase();
  const clinicJsonUrl = 'https://warangalonepoint.github.io/clinic-admin/clinics.json';
  const logsCsvUrl = 'https://warangalonepoint.github.io/clinic-admin/logs.csv';

  function formatDate(date) {
    const d = new Date(date);
    return `${d.getDate().toString().padStart(2, '0')}-${(d.getMonth() + 1).toString().padStart(2, '0')}-${d.getFullYear()}`;
  }

  async function loadClinicDetails() {
    const res = await fetch(clinicJsonUrl);
    const clinics = await res.json();
    const clinic = clinics.find(c => c.id.toLowerCase() === clinicId);
    if (!clinic) return alert('Clinic not found');

    document.getElementById('clinic-logo').src = `https://warangalonepoint.github.io/clinic-admin/logos/${clinic.logo}`;
    document.getElementById('clinic-name').textContent = clinic.name;
    document.getElementById('clinic-address').textContent = clinic.address;
    document.getElementById('clinic-plan').textContent = `Plan: â‚¹${clinic.plan || 'free'}`;
  }

  async function loadLogs() {
    const res = await fetch(logsCsvUrl);
    const text = await res.text();
    const rows = text.trim().split('\n').slice(1).map(r => r.split(','));
    const today = formatDate(new Date());
    const appointments = rows.filter(r => r[0].toLowerCase() === clinicId && r[1] === today);

    const appointmentBody = document.getElementById('appointment-body');
    appointmentBody.innerHTML = appointments.length ? '' : '<tr><td colspan="3">No appointments today.</td></tr>';
    appointments.forEach(r => {
      const row = `<tr><td>${r[2]}</td><td>${r[3]}</td><td>${r[4]}</td></tr>`;
      appointmentBody.insertAdjacentHTML('beforeend', row);
    });

    const notesBody = document.getElementById('notes-body');
    notesBody.innerHTML = appointments.length ? '' : '<tr><td colspan="3">No notes available.</td></tr>';
    appointments.forEach(r => {
      const row = `<tr><td>${r[2]}</td><td>${r[3]}</td><td>${r[6]}</td></tr>`;
      notesBody.insertAdjacentHTML('beforeend', row);
    });
  }

  loadClinicDetails();
  loadLogs();
</script></body>
</html>
