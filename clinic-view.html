<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clinic View - WarangalOneStop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
    }

    .clinic-info {
      background-color: #1f1f1f;
      border-radius: 12px;
      padding: 16px;
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 20px;
    }

    .clinic-info img {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      object-fit: cover;
    }

    .clinic-meta {
      display: flex;
      flex-direction: column;
    }

    .clinic-meta h2 {
      margin: 0;
      font-size: 20px;
      color: #00ff88;
    }

    .clinic-meta p {
      margin: 4px 0;
      font-size: 14px;
    }

    h3 {
      margin-top: 30px;
      font-size: 18px;
      color: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #1f1f1f;
      border-radius: 12px;
      overflow: hidden;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #333;
    }

    th {
      background-color: #222;
      color: #00ff88;
    }

    td {
      font-size: 14px;
    }

    .plan-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: bold;
      font-size: 0.9em;
    }

    .plan-free {
      background-color: #555;
      color: white;
    }

    .plan-basic {
      background-color: #1e90ff;
      color: white;
    }

    .plan-pro {
      background-color: #28a745;
      color: white;
    }

    .plan-lifetime {
      background-color: gold;
      color: black;
    }
  </style>
</head>
<body>
  <div class="clinic-info">
    <img id="clinic-logo" src="logo.png" alt="Logo">
    <div class="clinic-meta">
      <h2 id="clinic-name">Clinic Name</h2>
      <p id="clinic-address">Clinic Address</p>
      <p>Plan: <span id="clinic-plan" class="plan-badge plan-free">Free</span></p>
    </div>
  </div>

  <h3>Today's Appointments</h3>
  <table id="appointments-table">
    <thead>
      <tr>
        <th>Time</th>
        <th>Patient</th>
        <th>Reason</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="3">Loading...</td></tr>
    </tbody>
  </table>

  <script>
    const queryParams = new URLSearchParams(window.location.search);
    const clinicId = queryParams.get("clinic") || "warangal onestop clinic";
    const today = new Date().toISOString().split("T")[0];

    async function loadClinicData() {
      const clinicResp = await fetch("https://warangalonepoint.github.io/clinic-admin/clinics.json");
      const clinics = await clinicResp.json();
      const currentClinic = clinics.find(c => c.id.toLowerCase() === clinicId.toLowerCase());

      if (currentClinic) {
        document.getElementById("clinic-name").textContent = currentClinic.name;
        document.getElementById("clinic-address").textContent = currentClinic.address || "—";
        document.getElementById("clinic-logo").src = currentClinic.logo || "logo.png";

        const plan = currentClinic.plan || "free";
        let planClass = "plan-free";

        switch (plan.toLowerCase()) {
          case "free":
            planClass = "plan-free"; break;
          case "1499":
          case "basic":
            planClass = "plan-basic"; break;
          case "4999":
          case "pro":
            planClass = "plan-pro"; break;
          case "lifetime":
            planClass = "plan-lifetime"; break;
        }

        const planBadge = document.getElementById("clinic-plan");
        planBadge.textContent = "₹" + plan;
        planBadge.className = `plan-badge ${planClass}`;
      }
    }

    async function loadAppointments() {
      const resp = await fetch("https://warangalonepoint.github.io/clinic-admin/logs.csv");
      const text = await resp.text();
      const rows = text.split("\n").slice(1).map(r => r.split(","));
      const tableBody = document.querySelector("#appointments-table tbody");
      tableBody.innerHTML = "";

      const filtered = rows.filter(r =>
        r[0].trim().toLowerCase() === clinicId.toLowerCase() &&
        r[1].trim() === today &&
        r[4].trim().toLowerCase() === "booked"
      );

      if (filtered.length === 0) {
        tableBody.innerHTML = `<tr><td colspan="3">No appointments today.</td></tr>`;
        return;
      }

      filtered.forEach(row => {
        const [ , , time, name, reason ] = row;
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${time}</td><td>${name}</td><td>${reason}</td>`;
        tableBody.appendChild(tr);
      });
    }

    loadClinicData();
    loadAppointments();
  </script>
</body>
</html>
